1. One example of where concurrency could damage our service is when the endpoints /{group_id}/users/{user_id}/purchases is called at the same time as /{uid1}/pay/{uid2}. If the isolation level was lower, it could happen that the PAY endpoint reads the debt between user1 and user2, and then, the PURCHASE endpoint would add or subtract an amount to the amount, and then when PAY set the debt to 0, we lost that PURCHASE amount. This could be solved by ledgerizing the transactions table, as we have for our implementation. This makes all endpoints sum all relevant transactions everytime, and therefore information is never lost. If those two endpoints were called, the new PURCHASE amount would not be settled, but at least we would never lose the information of the transaction.
2. Another example would be when the endpoints /{group_id}/users/{user_id}/purchases and /{user_id}/balancebreakdown post happen concurrently. In this case, if both of those happen at the same time, the balance breakdown might read some value for a debt, and then the purchases endpoint would make the debt between two users either larger or smaller. Then, when settling all the debts that the user has, we could settle debts that are not completely updated, with the operation not actually clearing all debts. There is no way of completely solving this, but we added a Get endpoint with the same name, so that we can check if that were to happen, and then run the post again to clear all debt.
3. Lastly, we could have issues when the endpoints /{uid1}/pay/{uid2} and /{user_id}/balancebreakdown post happened concurrently. This would only be an issue if uid1 = user_id or if uid2 = user_id. It is not an issue with a ledgerized transactions table, but if they both happen at the same exact time, and the insert from PAY happens between the select and the insert from BREAKDOWN, then the debt will be cleared twice. This can’t happen, however, because we are assuming that only the user can call either of those endpoints, and they can’t call both of them. Otherwise, the debt from user1 to user 2 of 20$ would change to -20$, or 20$ from user2 to user1, which is not a big problem, especially considering that user1 would have to be logged in in 2 devices and fire calls at the same time for that to happen.
